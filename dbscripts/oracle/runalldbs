#!/bin/bash

#+++___________________________________________________________________________________
#
#
# Script name:                  runalldbs
#
# Description:
#
# Parameters:
#
# Environment:
#
# Return codes:
#
# Modification history:
#
#       23-Jul-2004     1.0     oracle    Original version
#
#+++___________________________________________________________________________________

CS_TOP=${CS_TOP:-/opt/dsp}
. ${CS_TOP}/env/dsp.env
. ${CS_TOP}/env/funcs.sh


#
# Script starts here
#
#
#set_error_trap

if [ $# -lt 1 ]
then
    usage
fi

unset TWO_TASK
export ORAENV_ASK=NO

VERBOSE="NO"
if [ "$1" = "-v" ]
then
    VERBOSE="YES"
    shift
fi

for ORACLE_SID in $(runningdbs)
do
  if [ "$VERBOSE" = "NO" ]
  then
    echo "-----------------------------------------------------------------------------------------------"
    echo "sid:${ORACLE_SID} (host=${HOSTNAME})"
    echo "-----------------------------------------------------------------------------------------------"
    echo
  fi
    export ORACLE_BASE=${ORACLE_BASE:-}
    export TNS_ADMIN=${TNS_ADMIN:-}

    . /usr/local/bin/oraenv 2>&1 > /dev/null

    if [ "$VERBOSE" = "NO" ]
    then
        PARAMS=$(echo ${*} | sed -e "s/%%SID%%/${ORACLE_SID}/g")
        #echo "vanilla=[${*}]"
        #echo " params=[${PARAMS}]"
        ${PARAMS}
    else
	eval ${*} | sed -e "s/^/${ORACLE_SID}:${HOSTNAME}>> /"
    fi

  if [ "$VERBOSE" = "NO" ]
  then
    echo
    echo
  fi
done



exit $EXITCODE

