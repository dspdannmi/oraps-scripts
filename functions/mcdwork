
function mcdwork
    {
    settoday

    notes_template_file=${CS_TOP}/resources/templates/work_notes.txt.template

    notes_file=readme.txt

    suffix="${*}"

    if [ "${suffix}" != "" ]
    then
        suffix=".${suffix// /_}"	# replace spaces with _ and add .
    fi

    if [ "${WORKDIR_TOP}" = "" ]
    then
        echo "WARNING: WORKDIR_TOP not set - creating under $HOME/work"
        topdir=${HOME}/work
    else
        topdir=${WORKDIR_TOP}        
    fi

    dir=${topdir}/$today${suffix}

    if [ -e ${dir} ] 
    then
	echo "warn: ${dir} already exists"
    else
	mkdir -p ${dir} || echo "mcd: mkdir error"
    fi

    if [ -d ${dir} ]
    then
        export CURRENT_WORKDIR=${dir}
	cd ${dir}

        if [ -f ${notes_templates_file} ]
        then
            cp ${notes_template_file} ${notes_file}
            status=$?
        else
            echo "WARNING: notes templates file [${notes_templates_file} does not exist - creating on fly - please report this to maintainers"

            (
            echo "DATE:		XX_datetime_XX"
            echo ""
            echo "WORKING DIR:"
            echo "XX_working_directory_XX"
            echo
            echo "CONSULTANT:"
            echo ""
            echo "DESCRIPTION:"
            echo ""
            echo "NOTES:"
            ) > ${notes_file}
            status=$?

        fi

        sed -i -e "s;XX_working_directory_XX;${PWD};" -e "s/XX_datetime_XX/$(date +%Y-%m-%d:%H:%M:%S)/" ${notes_file}

        vi ${notes_file}
    else
	echo "mcd: error: ${dir} does not exist"
    fi
    }


